<!DOCTYPE html>
<!--
	Shine by TEMPLATE STOCK
	templatestock.co @templatestock
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>IOT Quân và Long</title>

		
		<!-- WEB FONTS -->
		<link href='http://fonts.googleapis.com/css?family=Roboto:100,300,100italic,400,300italic' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
		<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> -->
		
		<!-- BOOTSTRAP -->
		<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
		<!-- FONT AWESOME -->
		<link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
		<!-- CUSTOM STYLING -->
		<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
		<!-- PRELOADER -->	
		<link rel="stylesheet" href="{{ url_for('static', filename='css/loader.css') }}">

		
	</head>
	
<body>
	<!-- PRELOADER -->
		<div id="loader-wrapper">
			<div id="loader"><div class="sk-spinner sk-spinner-cube-grid"><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div></div></div>
		</div>	
		
	<!-- HEADER -->
		<section id="header">
			<div class="container">
				<div class="row text-center">
					<div class="col-md-8">
						<img class="logo" src="static/images/test.png" />
						<div class="form-container">
							{% if data %}
							<form method="POST" action="/update">
								<div class="form-group">
									<label for="MUC">Trạng thái</label>
									<select name="MUC" id="MUC" class="form-select">
										<option value="0" {% if data['MUC'] == 0 %}selected{% endif %}>Đóng</option>
										<option value="1" {% if data['MUC'] == 1 %}selected{% endif %}>Mở một nửa</option>
										<option value="2" {% if data['MUC'] == 2 %}selected{% endif %}>Mở toàn bộ</option>
									</select>
								</div>
						
								<div class="form-group">
									<label for="ACTIVE_LIGHT">Active Light</label>
									<div class="toggle-button" id="ACTIVE_LIGHT">
										<div class="indicator"></div>
									</div>
									<input type="hidden" name="ACTIVE_LIGHT" id="ACTIVE_LIGHT_input">
								</div>
						
								<div class="form-group">
									<label for="ACTIVE_TEMPERATURE">Active Temperature</label>
									<div class="toggle-button" id="ACTIVE_TEMPERATURE">
										<div class="indicator"></div>
									</div>
									<input type="hidden" name="ACTIVE_TEMPERATURE" id="ACTIVE_TEMPERATURE_input">
								</div>
						
								<div class="form-group">
									<label for="ACTIVE_DISTANCE">Active Distance</label>
									<div class="toggle-button" id="ACTIVE_DISTANCE">
										<div class="indicator"></div>
									</div>
									<input type="hidden" name="ACTIVE_DISTANCE" id="ACTIVE_DISTANCE_input">
								</div>

								<div class="form-group form-group1">
									<label for="TEMPERATURE">Nhiệt độ</label>
								</div>

								<div class="form-group">									
									<input  type="range" name="TEMPERATURE" id="TEMPERATURE" min="0" max="100" value="{{ data['TEMPERATURE'] }}" />
									<span id="temperature_value">{{ data['TEMPERATURE'] }}</span>
								</div>
						
								<div class="form-group form-group1">
									<label for="LIGHT">Ánh sáng</label>									
								</div>

								<div class="form-group">									
									<input type="range" name="LIGHT" id="LIGHT" min="0" max="1200" value="{{ data['LIGHT'] }}" />
									<span id="light_value">{{ data['LIGHT'] }}</span>
								</div>
						
								
							</form>
							{% else %}
							<p>Không có dữ liệu.</p>
							{% endif %}							
						</div>
						
						<div id="countdown" class="white-text"></div>
					</div>
				</div>
			</div>
			<div class="animation">
			<a class="arrow-down-animation" data-scroll href="#about"><i class="fa fa-angle-down"></i></a>
			</div>
		</section>
	<!-- HEADER ENDS -->
		
	<!-- ABOUT -->
		<section id="about">
			<div class="container">
				<div class="row text-center">
					<!-- Section 1 -->
					<div data-sr="enter top over 1s, wait 0.3s, move 24px, reset" class="col-md-4">
						<i class="fa fa-laptop"></i>
						<h3>Responsive Design</h3>
						<div class="colored-line-small-center"></div>
						<p>Lorem ipsum dolor sit amet, ed do eiusmod tempor incididunt ut labore et dolore magna.</p>
					</div>
					<!-- Section 2 -->
					<div data-sr="enter bottom over 1s, wait 0.3s, move 24px, reset" class="col-md-4 middle">
						<i class="fa fa-lightbulb-o"></i>
						<h3>Creative Design</h3>
						<div class="colored-line-small-center"></div>						
						<p>Lorem ipsum dolor sit amet, ed do eiusmod tempor incididunt ut labore et dolore magna.</p>						
					</div>
					<!-- Section 3 -->
					<div data-sr="enter top over 1s, wait 0.3s, move 24px, reset" class="col-md-4">
						<i class="fa fa-newspaper-o"></i>
						<h3>Mailchimp Ready</h3>
						<div class="colored-line-small-center"></div>
						<p>Lorem ipsum dolor sit amet, ed do eiusmod tempor incididunt ut labore et dolore magna.</p>						
					</div>
				</div>
			</div>			
		</section>
	<!-- ABOUT ENDS -->
	
	<!-- SUBSCRIBE -->
		<section id="subscribe">
			<div class="container">
				<i data-sr="ease-in over 1s, reset" class="fa fa-envelope icontop"></i>
				<div class="row text-center">
					<div class="col-md-8 col-md-offset-2">
						<h2 data-sr="enter top over 1s, wait 0.3s, move 24px, reset" class="white-text">Sign up to our Newsletter</h2>
						<h5 data-sr="enter bottom over 1s, wait 0.3s, move 24px, reset" class="white-text">Stay up2date with climb-up</h5>
						<!-- MAILCHIMP FORM -->
						<form id="mc_form" role="form">
							<input data-sr="enter top over 1s, wait 0.3s, move 24px, reset" type="email" class="form-control" id="mc-email" name="mc-email" placeholder="Your Email" />
							<button data-sr="enter bottom over 1s, wait 0.3s, move 24px, reset" type="submit" class="button-leweb">Submit</button>
							<label for="mc-email" class="mc-email"></label>
						</form>
						<!-- MAILCHIMP FORM ENDS -->
					</div>
				</div>
			</div>	
		</section>
	<!-- SUBSCRIBE ENDS -->
	
	<!-- CONTACT US -->
		<section id="contact">
			<div class="container">
				<div class="row text-center">
					<div class="col-md-8 col-md-offset-2">
						<!-- CONTACT FORM -->
						<form method="post" action="">
							<p data-sr="enter top over 1s, wait 0.3s, move 24px, reset" class="contact-info text-center">Get in Contact. Fill up the form below. All fields are required.</p>
							<div data-sr="enter left over 1s, wait 0.3s, move 24px, reset" class="form-group col-md-6">
								<input type="text" class="form-control" id="name" name="name" placeholder="Your Name" />
							</div>
							<div data-sr="enter right over 1s, wait 0.3s, move 24px, reset" class="form-group col-md-6">
								<input type="email" class="form-control" id="email" name="email" placeholder="Your Email" />
							</div>
							<div data-sr="enter bottom over 1s, wait 0.3s, move 24px, reset" class="form-group col-md-12">
								<input type="text" class="form-control" id="phone" name="phone" placeholder="Phone Number" />
							</div>
							<div data-sr="enter bottom over 1s, wait 0.3s, move 24px, reset" class="form-group col-md-12">
								<textarea cols="60" rows="3" id="comment" name="comment" class="form-control" placeholder="Write your comment here..."></textarea>
							</div>
							<div data-sr="enter bottom over 1s, wait 0.3s, move 24px, reset" class="form-group col-sm-12 ">
								<button type="submit" class="button-leweb">Send Message</button>
							</div>
						</form>
									
						<!-- AFTER SENDING MESSAGE -->
						<div id="success" class="col-md-12 col-sm-12 text-center">
							<i class="fa fa-check-circle"></i>
							<strong>Message successfully sent</strong>
							<p>Thanks for contacting us. We will respond to you as soon as possible!</p>
						</div>									
						<!-- CONTACT FORM ENDS -->	
					</div>				
				</div>
			</div>
		</section>
	<!-- CONTACT ENDS -->
	
	<!-- FOOTER -->
		<footer id="footer">
			<div class="container">
				<div class="row text-center">	
					<p>
						&copy; 2016 Shine | DESIGN BY <a href="http://templatestock.co">Template Stock</a>
						<span class="social">
							<a href="#"><i class="fa fa-facebook-square"></i></a>
							<a href="#"><i class="fa fa-twitter-square"></i></a> 
							<a href="#"><i class="fa fa-google-plus-square"></i></a>
						</span>
					</p>
				</div>
			</div>		
		</footer>
	<!-- FOOTER ENDS -->	

	
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="static/js/bootstrap.min.js"></script>
		<!-- SMOOTH SCROLL -->
		<script src="static/js/smooth-scroll.min.js"></script>
		<!-- PARALLAX IMG -->
		<script src="static/js/jquery.parallax-1.1.3.js"></script>
		<!-- SCROLL REVEAL -->
		<script src="static/js/scrollReveal.min.js"></script>
		<!-- FUNCTIONS -->
		<script src="static/js/functions.js"></script>


		<script>
			// Khởi tạo SpeechRecognition API (sử dụng cho trình duyệt hỗ trợ)
	  const recordButton = document.getElementById('recordButton');
	  const recordingResult = document.getElementById('recordingResult');
	  const mucSelect = document.getElementById('MUC');
	  
	  // Kiểm tra hỗ trợ SpeechRecognition
	  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
	  if (SpeechRecognition) {
		  const recognition = new SpeechRecognition();
		  recognition.lang = 'vi-VN'; // Cấu hình ngôn ngữ thành tiếng Việt
		  recognition.continuous = true; // Thu âm liên tục
		  recognition.interimResults = true; // Cập nhật kết quả tạm thời
	  
		  // Khi bắt đầu thu âm
		  recognition.onstart = function() {
			  recordButton.innerText = 'Đang ghi âm... (Giữ để dừng)';
		  };
	  
		  // Khi kết thúc thu âm
		  recognition.onend = function() {
			  recordButton.innerText = 'Giữ để Ghi Âm';
		  };
	  
		  // Khi có kết quả thu âm (tạm thời hoặc cuối cùng)
		  recognition.onresult = function(event) {
			  let transcript = '';
			  for (let i = event.resultIndex; i < event.results.length; i++) {
				  transcript += event.results[i][0].transcript;
			  }
	  
			  recordingResult.innerText = transcript;
	  
			  // Nếu có từ khóa "đóng" trong kết quả, MUC sẽ được đặt về 0, nếu không sẽ là 2
			  if (transcript.toLowerCase().includes('đóng')) {
				  mucSelect.value = 0;
			  }
			  if (transcript.toLowerCase().includes('mở')) {
				  mucSelect.value = 2;
			  } 
	  
			  // Gọi updateFirebase khi MUC thay đổi
			  updateFirebase();
		  };
	  
		  // Xử lý khi giữ nút để bắt đầu ghi âm
		  recordButton.addEventListener('mousedown', function() {
			  recognition.start();
		  });
	  
		  // Xử lý khi thả nút để dừng ghi âm
		  recordButton.addEventListener('mouseup', function() {
			  recognition.stop();
		  });
	  
		  // Cũng có thể dừng ghi âm khi nhả nút
		  recordButton.addEventListener('mouseleave', function() {
			  recognition.stop();
		  });
	  } else {
		  recordingResult.innerText = 'Trình duyệt của bạn không hỗ trợ ghi âm.';
	  }
	  
	  
		  </script>
	  
		  <script>
			  function updateIndicator(elementId, inputId, state) {
				  const button = document.getElementById(elementId);
				  const indicator = button.querySelector('.indicator');
				  const input = document.getElementById(inputId);
		  
				  if (state === 1) {
					  indicator.style.left = "30px";
					  button.classList.add('active');
					  input.value = 1;
				  } else {
					  indicator.style.left = "1px";
					  button.classList.remove('active');
					  input.value = 0;
				  }
			  }
		  
			  window.onload = function() {
				  updateIndicator('ACTIVE_LIGHT', 'ACTIVE_LIGHT_input', {{ data['ACTIVE_LIGHT'] }});
				  updateIndicator('ACTIVE_TEMPERATURE', 'ACTIVE_TEMPERATURE_input', {{ data['ACTIVE_TEMPERATURE'] }});
				  updateIndicator('ACTIVE_DISTANCE', 'ACTIVE_DISTANCE_input', {{ data['ACTIVE_DISTANCE'] }});
			  }
		  
			  document.querySelectorAll('.toggle-button').forEach(function(button) {
				  button.addEventListener('click', function() {
					  const inputId = button.id + '_input';
					  const currentState = document.getElementById(inputId).value;
					  updateIndicator(button.id, inputId, currentState == 1 ? 0 : 1);
					  updateFirebase();
				  });
			  });
		  
			  document.querySelectorAll('input[type="range"]').forEach(function(slider) {
				  slider.addEventListener('input', function() {
					  const valueDisplay = document.getElementById(slider.name + '_value');
					  valueDisplay.innerText = slider.value;
					  updateFirebase(); // Gọi updateFirebase khi giá trị của slider thay đổi
				  });
			  });
		  
			  document.getElementById('MUC').addEventListener('change', function() {
			  console.log("thay doi muc")
				  updateFirebase(); // Gọi updateFirebase khi giá trị của MUC thay đổi
			  });
		  
			  document.getElementById('TEMPERATURE').addEventListener('change', function() {
				  updateFirebase(); // Gọi updateFirebase khi giá trị của TEMPERATURE thay đổi
			  });
		  
			  document.getElementById('LIGHT').addEventListener('change', function() {
				  updateFirebase(); // Gọi updateFirebase khi giá trị của LIGHT thay đổi
			  });
		  
			  function updateFirebase() {
				  const data = {
					  MUC: document.getElementById('MUC').value,
					  ACTIVE_LIGHT: document.getElementById('ACTIVE_LIGHT_input').value,
					  ACTIVE_TEMPERATURE: document.getElementById('ACTIVE_TEMPERATURE_input').value,
					  ACTIVE_DISTANCE: document.getElementById('ACTIVE_DISTANCE_input').value,
					  TEMPERATURE: document.getElementById('TEMPERATURE').value,
					  LIGHT: document.getElementById('LIGHT').value
				  };
		  
				  fetch('/update', {
					  method: 'POST',
					  headers: { 'Content-Type': 'application/json' },
					  body: JSON.stringify(data)
				  }).then(response => response.json())
					.then(data => console.log('Successfully updated:', data))
					.catch(error => console.error('Error updating device state:', error));
			  }
		  
			  // Polling API to fetch new data every 5 seconds
			  setInterval(function() {
				  fetch('/poll')
					  .then(response => response.json())
					  .then(data => {
						  // Cập nhật các giá trị trên giao diện người dùng
						  updateIndicator('ACTIVE_LIGHT', 'ACTIVE_LIGHT_input', data.ACTIVE_LIGHT);
						  updateIndicator('ACTIVE_TEMPERATURE', 'ACTIVE_TEMPERATURE_input', data.ACTIVE_TEMPERATURE);
						  updateIndicator('ACTIVE_DISTANCE', 'ACTIVE_DISTANCE_input', data.ACTIVE_DISTANCE);
		  
						  document.getElementById('TEMPERATURE').value = data.TEMPERATURE;
						  document.getElementById('temperature_value').innerText = data.TEMPERATURE;
						  document.getElementById('LIGHT').value = data.LIGHT;
						  document.getElementById('light_value').innerText = data.LIGHT;
					  })
					  .catch(error => console.error('Error polling data:', error));
			  }, 1000); // Mỗi 1 giây
		  </script>
		  
</body>
</html>